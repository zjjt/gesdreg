{"version":3,"sources":["meteor://ðŸ’»app/packages/ostrio:cookies/cookies.js"],"names":["module","export","Cookies","Meteor","watch","require","v","HTTP","WebApp","isServer","NoOp","urlRE","helpers","isUndefined","obj","isObject","Object","_helpers","i","prototype","toString","call","length","decode","decodeURIComponent","encode","encodeURIComponent","pairSplitRegExp","fieldContentRegExp","tryDecode","str","d","e","parse","options","Error","opt","val","key","eqIndx","split","forEach","pair","indexOf","substr","trim","slice","serialize","name","test","escape","value","pairs","isNumber","maxAge","push","domain","isString","path","expires","expire","Infinity","Date","toUTCString","httpOnly","secure","firstPartyOnly","sameSite","join","__cookies","_cookies","TTL","runOnServer","response","cookies","get","_tmp","_cs","hasOwnProperty","set","opts","undefined","newCookie","isClient","document","cookie","setHeader","remove","keys","has","send","cb","window","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","__middlewareHandler","req","res","self","headers","auto","handler","isLoadedOnServer","connectHandlers","use","next","_parsedUrl","_cObj","_cKeys","_cArr","_cStr","writeHead","end","middleware"],"mappings":"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","file":"/packages/ostrio_cookies.js","sourcesContent":["import { Meteor } from 'meteor/meteor';\n\nlet HTTP;\nlet WebApp;\n\nif (Meteor.isServer) {\n  WebApp = require('meteor/webapp').WebApp;\n} else {\n  HTTP = require('meteor/http').HTTP;\n}\n\nconst NoOp  = () => {};\nconst urlRE = /\\/___cookie___\\/set/;\nconst helpers = {\n  isUndefined(obj) {\n    return obj === void 0;\n  },\n  isObject(obj) {\n    return obj === Object(obj);\n  }\n};\nconst _helpers = ['String', 'Number'];\nfor (let i = 0; i < _helpers.length; i++) {\n  helpers['is' + _helpers[i]] = function (obj) {\n    return Object.prototype.toString.call(obj) === '[object ' + _helpers[i] + ']';\n  };\n}\n\n/*\n * @url https://github.com/jshttp/cookie/blob/master/index.js\n * @name cookie\n * @author jshttp\n * @license\n * (The MIT License)\n *\n * Copyright (c) 2012-2014 Roman Shtylman <shtylman@gmail.com>\n * Copyright (c) 2015 Douglas Christopher Wilson <doug@somethingdoug.com>\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * 'Software'), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\nconst decode = decodeURIComponent;\nconst encode = encodeURIComponent;\nconst pairSplitRegExp = /; */;\n\n/*\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\nconst fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/*\n * @function\n * @name tryDecode\n * @param {String} str\n * @param {Function} d\n * @summary Try decoding a string using a decoding function.\n * @private\n */\nconst tryDecode = (str, d) => {\n  try {\n    return d(str);\n  } catch (e) {\n    return str;\n  }\n};\n\n/*\n * @function\n * @name parse\n * @param {String} str\n * @param {Object} [options]\n * @return {Object}\n * @summary\n * Parse a cookie header.\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n * @private\n */\nconst parse = (str, options) => {\n  if (typeof str !== 'string') {\n    throw new Meteor.Error(404, 'argument str must be a string');\n  }\n  const obj = {};\n  const opt = options || {};\n  let val;\n  let key;\n  let eqIndx;\n\n  str.split(pairSplitRegExp).forEach((pair) => {\n    eqIndx = pair.indexOf('=');\n    if (eqIndx < 0) {\n      return;\n    }\n    key = pair.substr(0, eqIndx).trim();\n    val = pair.substr(++eqIndx, pair.length).trim();\n    if (val[0] === '\"') {\n      val = val.slice(1, -1);\n    }\n    if (void 0 === obj[key]) {\n      obj[key] = tryDecode(val, (opt.decode || decode));\n    }\n  });\n  return obj;\n};\n\n/*\n * @function\n * @name serialize\n * @param {String} name\n * @param {String} val\n * @param {Object} [options]\n * @return {String}\n * @summary\n * Serialize data into a cookie header.\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n * serialize('foo', 'bar', { httpOnly: true }) => \"foo=bar; httpOnly\"\n * @private\n */\nconst serialize = (key, val, opt = {}) => {\n  let name;\n\n  if (!fieldContentRegExp.test(key)) {\n    name = escape(key);\n  } else {\n    name = key;\n  }\n\n  let value;\n  if (!helpers.isUndefined(val)) {\n    value = encode(val);\n    if (value && !fieldContentRegExp.test(value)) {\n      value = escape(value);\n    }\n  } else {\n    value = '';\n  }\n\n  const pairs = [`${name}=${value}`];\n\n  if (helpers.isNumber(opt.maxAge)) {\n    pairs.push(`Max-Age=${opt.maxAge}`);\n  }\n\n  if (opt.domain && helpers.isString(opt.domain)) {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new Meteor.Error(404, 'option domain is invalid');\n    }\n    pairs.push(`Domain=${opt.domain}`);\n  }\n\n  if (opt.path && helpers.isString(opt.path)) {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new Meteor.Error(404, 'option path is invalid');\n    }\n    pairs.push(`Path=${opt.path}`);\n  }\n\n  opt.expires = opt.expires || opt.expire || false;\n  if (opt.expires === Infinity) {\n    pairs.push('Expires=Fri, 31 Dec 9999 23:59:59 GMT');\n  } else if (opt.expires instanceof Date) {\n    pairs.push(`Expires=${opt.expires.toUTCString()}`);\n  } else if (opt.expires === 0) {\n    pairs.push('Expires=0');\n  } else if (helpers.isNumber(opt.expires)) {\n    pairs.push(`Expires=${(new Date(opt.expires)).toUTCString()}`);\n  }\n\n  if (opt.httpOnly) {\n    pairs.push('HttpOnly');\n  }\n\n  if (opt.secure) {\n    pairs.push('Secure');\n  }\n\n  if (opt.firstPartyOnly) {\n    pairs.push('First-Party-Only');\n  }\n\n  if (opt.sameSite) {\n    pairs.push('SameSite');\n  }\n\n  return pairs.join('; ');\n};\n\n/*\n * @locus Anywhere\n * @class __cookies\n * @param _cookies {Object|String} - Current cookies as String or Object\n * @param TTL {Number} - Default cookies expiration time (max-age) in milliseconds, by default - session (false)\n * @param runOnServer {Boolean} - Expose Cookies class to Server\n * @param response {http.ServerResponse|Object} - This object is created internally by a HTTP server\n * @summary Internal Class\n */\nclass __cookies {\n  constructor(_cookies, TTL, runOnServer, response) {\n    this.TTL         = TTL;\n    this.response    = response;\n    this.runOnServer = runOnServer;\n\n    if (helpers.isObject(_cookies)) {\n      this.cookies = _cookies;\n    } else {\n      this.cookies = parse(_cookies);\n    }\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name get\n   * @param {String} key  - The name of the cookie to read\n   * @param {String} _tmp - Unparsed string instead of user's cookies\n   * @summary Read a cookie. If the cookie doesn't exist a null value will be returned.\n   * @returns {String|void}\n   */\n  get(key, _tmp) {\n    const _cs = _tmp ? parse(_tmp) : this.cookies;\n    if (!key || !_cs) {\n      return void 0;\n    }\n\n    if (_cs.hasOwnProperty(key)) {\n      return _cs[key];\n    }\n\n    return void 0;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name set\n   * @param {String}  key   - The name of the cookie to create/overwrite\n   * @param {String}  value - The value of the cookie\n   * @param {Object}  opts  - [Optional] Cookie options (see readme docs)\n   * @summary Create/overwrite a cookie.\n   * @returns {Boolean}\n   */\n  set(key, value, opts = {}) {\n    if (key && !helpers.isUndefined(value)) {\n      if (helpers.isNumber(this.TTL) && opts.expires === undefined) {\n        opts.expires = new Date(+new Date() + this.TTL);\n      }\n      const newCookie = serialize(key, value, opts);\n      this.cookies[key] = value;\n      if (Meteor.isClient) {\n        document.cookie = newCookie;\n      } else {\n        this.response.setHeader('Set-Cookie', newCookie);\n      }\n      return true;\n    }\n    return false;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name remove\n   * @param {String} key    - The name of the cookie to create/overwrite\n   * @param {String} path   - [Optional] The path from where the cookie will be\n   * readable. E.g., \"/\", \"/mydir\"; if not specified, defaults to the current\n   * path of the current document location (string or null). The path must be\n   * absolute (see RFC 2965). For more information on how to use relative paths\n   * in this argument, see: https://developer.mozilla.org/en-US/docs/Web/API/document.cookie#Using_relative_URLs_in_the_path_parameter\n   * @param {String} domain - [Optional] The domain from where the cookie will\n   * be readable. E.g., \"example.com\", \".example.com\" (includes all subdomains)\n   * or \"subdomain.example.com\"; if not specified, defaults to the host portion\n   * of the current document location (string or null).\n   * @summary Remove a cookie(s).\n   * @returns {Boolean}\n   */\n  remove(key, path = '/', domain = '') {\n    if (key && this.cookies.hasOwnProperty(key)) {\n      const newCookie = serialize(key, '', {\n        domain,\n        path,\n        expires: new Date(0)\n      });\n\n      delete this.cookies[key];\n      if (Meteor.isClient) {\n        document.cookie = newCookie;\n      } else {\n        this.response.setHeader('Set-Cookie', newCookie);\n      }\n      return true;\n    } else if (!key && this.keys().length > 0 && this.keys()[0] !== '') {\n      const keys = Object.keys(this.cookies);\n      for (let i = 0; i < keys.length; i++) {\n        this.remove(keys[i]);\n      }\n      return true;\n    }\n    return false;\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name has\n   * @param {String} key  - The name of the cookie to create/overwrite\n   * @param {String} _tmp - Unparsed string instead of user's cookies\n   * @summary Check whether a cookie exists in the current position.\n   * @returns {Boolean}\n   */\n  has(key, _tmp) {\n    const _cs = _tmp ? parse(_tmp) : this.cookies;\n    if (!key || !_cs) {\n      return false;\n    }\n\n    return _cs.hasOwnProperty(key);\n  }\n\n  /*\n   * @locus Anywhere\n   * @memberOf __cookies\n   * @name keys\n   * @summary Returns an array of all readable cookies from this location.\n   * @returns {[String]}\n   */\n  keys() {\n    if (this.cookies) {\n      return Object.keys(this.cookies);\n    }\n    return [];\n  }\n\n  /*\n   * @locus Client\n   * @memberOf __cookies\n   * @name send\n   * @param cb {Function} - Callback\n   * @summary Send all cookies over XHR to server.\n   * @returns {void}\n   */\n  send(cb = NoOp) {\n    if (Meteor.isServer) {\n      cb(new Meteor.Error(400, 'Can\\'t run `.send()` on server, it\\'s Client only method!'));\n    }\n\n    if (this.runOnServer) {\n      HTTP.get(`${window.__meteor_runtime_config__.ROOT_URL_PATH_PREFIX || ''}/___cookie___/set`, cb);\n    } else {\n      cb(new Meteor.Error(400, 'Can\\'t send cookies on server when `runOnServer` is false.'));\n    }\n    return void 0;\n  }\n}\n\n/*\n * @function\n * @locus Server\n * @summary Middleware handler\n * @private\n */\nconst __middlewareHandler = (req, res, self) => {\n  let _cookies = {};\n  if (self.runOnServer) {\n    if (req.headers && req.headers.cookie) {\n      _cookies = parse(req.headers.cookie);\n    }\n    return new __cookies(_cookies, self.TTL, self.runOnServer, res);\n  }\n\n  throw new Meteor.Error(400, 'Can\\'t use middleware when `runOnServer` is false.');\n};\n\n\n/*\n * @locus Anywhere\n * @class Cookies\n * @param opts {Object}\n * @param opts.TTL {Number} - Default cookies expiration time (max-age) in milliseconds, by default - session (false)\n * @param opts.auto {Boolean} - [Server] Auto-bind in middleware as `req.Cookies`, by default `true`\n * @param opts.handler {Function} - [Server] Middleware handler\n * @param opts.runOnServer {Boolean} - Expose Cookies class to Server\n * @summary Main Cookie class\n */\nclass Cookies extends __cookies {\n  constructor(opts = {}) {\n    opts.TTL = helpers.isNumber(opts.TTL) ? opts.TTL : false;\n    opts.runOnServer = (opts.runOnServer !== false) ? true : false;\n\n    if (Meteor.isClient) {\n      super(document.cookie, opts.TTL, opts.runOnServer);\n    } else {\n      super({}, opts.TTL, opts.runOnServer);\n      opts.auto        = opts.auto !== false ? true : false;\n      this.handler     = opts.handler || (() => {});\n      this.runOnServer = opts.runOnServer;\n\n      if (this.runOnServer) {\n        if (!Cookies.isLoadedOnServer) {\n          if (opts.auto) {\n            WebApp.connectHandlers.use((req, res, next) => {\n              if (urlRE.test(req._parsedUrl.path)) {\n                if (req.headers && req.headers.cookie) {\n                  const _cObj  = parse(req.headers.cookie);\n                  const _cKeys = Object.keys(_cObj);\n                  const _cArr  = [];\n                  let   _cStr;\n\n                  for (let i = 0; i < _cKeys.length; i++) {\n                    _cStr = serialize(_cKeys[i], _cObj[_cKeys[i]]);\n                    if (!~_cArr.indexOf(_cStr)) {\n                      _cArr.push(_cStr);\n                    }\n                  }\n\n                  res.setHeader('Set-Cookie', _cArr);\n                }\n\n                res.writeHead(200);\n                res.end('');\n              } else {\n                req.Cookies = __middlewareHandler(req, res, this);\n                next();\n              }\n            });\n          }\n          Cookies.isLoadedOnServer = true;\n        }\n      }\n    }\n  }\n\n\n  /*\n   * @locus Server\n   * @memberOf Cookies\n   * @name middleware\n   * @summary Get Cookies instance into callback\n   * @returns {void}\n   */\n  middleware() {\n    if (!Meteor.isServer) {\n      throw new Meteor.Error(500, '[ostrio:cookies] Can\\'t use `.middleware()` on Client, it\\'s Server only!');\n    }\n\n    return (req, res, next) => {\n      this.handler && this.handler(__middlewareHandler(req, res, this));\n      next();\n    };\n  }\n}\n\nif (Meteor.isServer) {\n  Cookies.isLoadedOnServer = false;\n}\n\n/* Export the Cookies class */\nexport { Cookies };\n"]}